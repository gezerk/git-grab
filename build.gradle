String distDir = 'dists'
List archs = ['linux-386',
				  'linux-amd64',
				  'linux-arm',
				  'windows-386',
				  'windows-amd64',
				  'darwin-386',
				  'darwin-amd64']	

task goGet(type: Exec) {
	environment = ['GOPATH': '/Users/mmcgarr/Projects/github/jmcgarr/git-grab']
	commandLine 'go', 'get', '-v', 'github.com/jmcgarr/git-grab'
}

task goBuild << {
	println 'building all go distributions'
}

archs.each{ arch ->
	task "goBuild-$arch"(type: Exec, dependsOn: goGet) {
		environment = ['GOOS': arch.split('-')[0], 
					 'GOARCH': arch.split('-')[1]]
		commandLine 'go', 'build', '-v', '-ldflags', '-s', '-o', "dist/git-grab-$arch"
		ignoreExitValue true
	}

	goBuild.dependsOn tasks.findByName("goBuild-$arch")
}